Bootstrap: docker
From: nvidia/cuda:11.4.3-cudnn8-runtime-ubuntu20.04

%labels
       Author:Qi Yu
       
%environment
     export LC_ALL=C

%post
     export DEBIAN_FRONTEND=noninteractive
     apt-get update && \
     apt-get install -y --no-install-recommends \
       python3.8 \
       python3-pip \
       python3-dev \
       ffmpeg \
       libsm6 \
       libxext6 \
       build-essential \
       make \
       cmake \
       gcc \
       g++ \
       libgtk-3-dev \
       python3-wxgtk4.0 \
       locales \
       libxdamage1 \
       libglib2.0-0 \
       libgl1-mesa-dev \
       libdbus-1-3 \
       libfontconfig1 \
       libxkbcommon-x11-0 \
       libxcb-icccm4 \
       libxcb-image0 \
       libxcb-keysyms1 \
       libxcb-randr0 \
       libxcb-render-util0 \
       libxcb-shape0 \
       git \
       wget \

     apt-get clean && \
     rm -rf /var/lib/apt/lists/*
     locale-gen en_US.UTF-8 en_GB.UTF-8

     pip install --no-cache-dir deeplabcut[gui,tf]==2.3.4 && \
     pip uninstall -y opencv-python opencv-python-headless && \
     pip install --no-cache-dir opencv-python-headless && \
     pip install --upgrade numpy==1.21
